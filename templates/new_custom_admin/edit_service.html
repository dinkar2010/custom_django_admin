{% extends "new_custom_admin/base.html" %}
{% load static %}

{% block bodycontent %}

    <div class="page page-shop-single-product" xmlns="http://www.w3.org/1999/html">

                    <div class="pageheader">

                        <h2>Edit Service</h2>

                        <div class="page-bar">

                            <ul class="page-breadcrumb">
                                <li>
                                    <a href="/movinCartAdmin/"><i class="fa fa-home"></i> MovinCart</a>
                                </li>
                                <li>
                                    <a href="/movinCartAdmin/show_services">Services</a>
                                </li>
                                <li>
                                    <a href="#">Edit Service</a>
                                </li>
                            </ul>

                        </div>

                    </div>

                    <div class="pagecontent">



                        <div class="add-nav">
                            <div class="nav-heading">
                                <h3>Service - {{ service.name }}</h3>
                                <span class="controls pull-right">
                                  <a href="/movinCartAdmin/show_services/" class="btn btn-ef btn-ef-1 btn-ef-1-warning btn-ef-1c mb-10" data-toggle="tooltip" title="Back"><i>Back</i></a>
                                  <a href="#" onclick="validate_n_submit()" class="btn btn-ef btn-ef-1 btn-ef-1-success btn-ef-1b mb-10" data-toggle="tooltip" title="Save"><i>Save</i></a>
                                </span>
                            </div>

                            <div role="tabpanel">

                                <!-- Nav tabs -->
                                <ul class="nav nav-tabs" role="tablist">
                                    <li role="presentation" class="active"><a href="#details" aria-controls="details" role="tab" data-toggle="tab">Service Details</a></li>
                                    <li role="presentation"><a href="#imageTab" aria-controls="inventory" role="tab" data-toggle="tab">Image</a></li>
                                    <li role="presentation"><a href="#categoryTab" aria-controls="inventory" role="tab" data-toggle="tab">Category & Sub Category</a></li>
                                    <li role="presentation"><a href="#historyTab" aria-controls="history" role="tab" data-toggle="tab">History</a></li>
                                </ul>

                                <div class="tab-content">
                                    <!-- tab in tabs -->
                                    <div role="tabpanel" class="tab-pane active" id="details">
                                         <!-- row -->
                                        <div class="row">
                                            <!-- col -->
                                            <div class="col-md-12">
                                                <!-- tile -->
                                                <section class="tile">

                                                    <!-- tile header -->
                                                    <div class="tile-header dvd dvd-btm">
                                                        <h1 class="custom-font"><strong>Edit </strong> General Informations</h1>
                                                    </div>
                                                    <!-- /tile header -->
                                                    <!-- tile body -->
                                                    <div class="tile-body">
                                                        <form action="/movinCartAdmin/edit_service/{{ service.id }}/" method="POST" id="myForm" class="form-horizontal ng-pristine ng-valid" role="form">
                                                            {% csrf_token %}
                                                            <div class="form-group">
                                                                <label for="id" class="col-sm-2 control-label">Service ID: </label>
                                                                <div class="col-sm-10">
                                                                    <input type="text" class="form-control" name="s_id" id="s_id" placeholder="Service ID" value="{{ service.id }}" disabled="">
                                                                </div>
                                                            </div>

                                                            <div class="form-group">
                                                                <label for="name" class="col-sm-2 control-label">Service Name: <span class="text-lightred text-md">*</span></label>
                                                                <div class="col-sm-10">
                                                                    <input name="s_name" type="text" class="form-control" name="s_name" id="s_name" placeholder="Service Name" value="{{ service.name }}">
                                                                </div>
                                                            </div>

                                                            <div class="form-group">
                                                                <label for="name" class="col-sm-2 control-label">Service Active: <span class="text-lightred text-md">*</span></label>
                                                                <div class="col-sm-10">
                                                                    <label class="checkbox checkbox-custom-alt checkbox-custom">
                                                                        <input name="s_is_active" id ="service_active" {% if service.is_active %} checked {% endif %} type="checkbox"><i></i>
                                                                    </label>
                                                                </div>
                                                            </div>

                                                        </form>
                                                    </div>
                                                    <!-- /tile body -->
                                                </section>
                                                <!-- /tile -->
                                            </div>
                                            <!-- /col -->
                                        </div>
                                        <!-- /row -->
                                    </div>
                                    <!-- tab in tabs -->



                                <div role="tabpanel" class="tab-pane" id="imageTab">

                                    <!-- row -->
                                    <div class="row">
                                        <!-- col -->
                                        <div class="col-md-12">


                                            <!-- tile -->
                                            <section class="tile">

                                                <!-- tile header -->
                                                <div class="tile-header dvd dvd-btm">
                                                    <h1 class="custom-font"><strong>Edit </strong> Image</h1>
                                                </div>
                                                <!-- /tile header -->


                                                <!-- tile body -->
                                                <div class="tile-body" id="image_div">

                                                    <div class="table-responsive">
                                                        <table class="table table-hover table-striped">
                                                            <thead>
                                                            <tr>
                                                                <th style="width: 110px">Image</th>
                                                                <th>Path</th>
                                                                <th>Actions</th>
                                                            </tr>
                                                            </thead>
                                                            <tbody data-lightbox="gallery">
                                                            <tr>
                                                                <td>
                                                                    <a href="{{service.image}}" class="img-link" data-lightbox="gallery-item">
                                                                        <img src="{{service.image}}" alt="" class="thumb thumb-lg">
                                                                    </a>
                                                                </td>
                                                                <td><input type="text" class="form-control" id="service_image"placeholder="Image Label" value="{{service.image}}"></td>
                                                                <td>
                                                                    <button type="button" onclick="refresh_image()" class="btn btn-xs btn-success"/><i class="fa fa-upload"></i> Upload</a>
                                                                </td>
                                                            </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>

                                                </div>
                                                <!-- /tile body -->
                                            </section>
                                            <!-- /tile -->
                                        </div>
                                        <!-- /col -->
                                    </div>
                                    <!-- /row -->
                                </div>
                                    <!-- tab in tabs -->
                                    <div role="tabpanel" class="tab-pane" id="historyTab">
                                        <!-- row -->
                                        <div class="row">
                                            <!-- col -->
                                            <div class="col-md-12">
                                                <!-- tile -->
                                                <section class="tile tile">
                                                    <!-- tile header -->
                                                    <div class="tile-header dvd dvd-btm">
                                                        <h1 class="custom-font"><strong>Service </strong> History</h1>
                                                    </div>
                                                    <!-- /tile header -->
                                                    <!-- tile body -->
                                                    <div class="tile-body p-0">
                                                        <div class="table-responsive">
                                                            <table class="table table-hover table-striped">
                                                                <thead>
                                                                <tr>
                                                                    <th>ID</th>
                                                                    <th>Desription</th>
                                                                    <th>Date</th>
                                                                </tr>
                                                                </thead>
                                                                <tbody>
                                                                <tr>
                                                                    <td><a href="javascript:;">1</a></td>
                                                                    <td>Service Created</td>
                                                                    <td>{{ service.created_at }}</td>
                                                                </tr>
                                                                <tr>
                                                                    <td><a href="javascript:;">2</a></td>
                                                                    <td>Service Modified</td>
                                                                    <td>{{ service.modified_at }}</td>
                                                                </tr>
                                                                </tbody>
                                                            </table>
                                                        </div>

                                                    </div>
                                                    <!-- /tile body -->

                                                </section>
                                                <!-- /tile -->


                                            </div>
                                            <!-- /col -->
                                        </div>
                                        <!-- /row -->
                                    </div><!-- end ngRepeat: tab in tabs -->

                                    <div role="tabpanel" class="tab-pane" id="categoryTab">
                                        <!-- row -->
                                        <div class="row">
                                            <!-- col -->
                                            <div class="col-md-12">

                                                {% for key,value in cat_vs_sub_cat.items %}
                                                 <section class="tile collapsed">
                                                        <!-- tile header -->
                                                        <div class="tile-header dvd dvd-btm">
                                                            <table class="table table-custom">
                                                                 <tbody>
                                                                    <tr >
                                                                        <td style="width:80px;">{{key.id}}</td>
                                                                        <td style="width:200px;"><b><a href="#" target="_blank">{{key.name}}</a></b></td>
                                                                        <td style="width:80px;"><p style="display:none">{{key.display_order}}</p><input id="cat_display_order{{key.id}}" class="form-control" style="width:80px;" type="text" value="{{key.display_order}}"></td>
                                                                        <td style="width:10%;" ><p style="display:none">{{key.is_active}}</p>
                                                                            <select class="form-control" id="cat_is_active{{key.id}}" name="cat_visiblity">
                                                                                <option value="1" {% if key.is_active %} selected {%endif%} >ON</option>
                                                                                <option value="0" {%if not key.is_active %} selected {%endif%}>OFF</option>
                                                                            </select></td>
                                                                        <td style="width:200px;">
                                                                            <button id="save_cat_button{{ key.id }}" onclick="save_category({{ key.id }})" class="btn btn-success btn-rounded-20 mb-10"><i class="fa fa-save"></i></button>
                                                                        </td>
                                                                    </tr>
                                                                </tbody>
                                                            </table>

                                                            <ul class="controls">
                                                                <li class="dropdown">
                                                                    <a role="button" tabindex="0" class="tile-toggle">
                                                                        <span class="minimize"><i class="fa fa-angle-up"></i></span>
                                                                        <span class="expand"><i class="fa fa-angle-down"></i></span>
                                                                    </a>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                        <!-- /tile header -->
                                                        <!-- tile body -->
                                                        <div class="tile-body" style="display: none;">
                                                            <div class="table-responsive">
                                                                <table class="table table-striped table-hover table-custom">
                                                                    <thead>
                                                                    <tr>
                                                                        <th style="width:40px;">ID</th>
                                                                        <th>Sub Category Name</th>
                                                                        <th>Display Order</th>
                                                                        <th>Is Active</th>
                                                                        <th style="width:150px;" class="no-sort">Actions</th>
                                                                    </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                    {% if value %}
                                                                    {% for sub_cat in value %}
                                                                        <tr >
                                                                            <td>{{sub_cat.id}}</td>
                                                                            <td style="width:180px;"><a href="#" target="_blank">{{sub_cat.name}}</a></td>
                                                                            <td style="width:80px;"><p style="display:none">{{sub_cat.display_order}}</p><input id="cat_display_order{{sub_cat.id}}" class="form-control" style="width:80px;" type="text" value="{{sub_cat.display_order}}"></td>
                                                                            <td style="width:10%;" ><p style="display:none">{{sub_cat.is_active}}</p>
                                                                                <select class="form-control" id="cat_is_active{{sub_cat.id}}" name="cat_is_active">
                                                                                    <option value="1" {% if sub_cat.is_active %} selected {%endif%} >ON</option>
                                                                                    <option value="0" {%if not sub_cat.is_active %} selected {%endif%}>OFF</option>
                                                                                </select></td>
                                                                            <td style="width:150px;">
                                                                                <button id="save_cat_button{{ sub_cat.id }}" onclick="save_category({{ sub_cat.id }})" class="btn btn-success btn-rounded-20 mb-10"><i class="fa fa-save"></i></button>
                                                                            </td>
                                                                        </tr>
                                                                        {% endfor %}
                                                                    {% endif %}
                                                                    </tbody>
                                                                </table>
                                                            </div>



                                                        </div>
                                                        <!-- /tile body -->

                                                    </section>
                                                    <!-- /tile -->
                                            {% endfor %}


                                            </div>
                                            <!-- /col -->
                                        </div>
                                        <!-- /row -->
                                    </div><!-- end ngRepeat: tab in tabs -->


                                </div>
                            </div>
                        </div>
                    </div>
                </div>

        <div style="display:none" id="hidden"></div>


{% endblock %}
{% block jscontent %}

    <script>
        var changed_id_list=[];
         $('.form-control').each(function() {
           var elem = $(this);
           elem.data('oldVal', elem.val());
           elem.bind("propertychange change click keyup input paste", function(event){
              // If value has changed...
              id = elem.attr('id').replace("cat_display_order","").replace("cat_is_active","");
              // alert(id);
              if(id!="service_image" && id!="s_id" && id!="s_name"){
                  var save_button_id='save_cat_button'+id;
                  if(changed_id_list.indexOf(id)== -1){
                    changed_id_list.push(id);
                   }
                  document.getElementById(save_button_id).className="btn btn-danger btn-rounded-20 mb-10";
                }
           });
         });
    </script>

     <script>
        function validate_n_submit() {
            document.getElementById("myForm").submit();
        }
    </script>
    <script>

        function refresh_image(){
                var s_image = $('#service_image').val();
                if(s_image!=''){
                    var ref_image = '/movinCartAdmin/change_service_image/?service_id='+{{ service.id }}+'&service_image='+encodeURIComponent(s_image);
                    document.getElementById("image_div").innerHTML='<img src="{% static "ajax-loader.gif"%}"  style="padding-top:17px;padding-bottom:17px;margin-left: 48%;"/>';
                    $('#image_div').load(ref_image, function(){

                      });
                }
            }

    </script>

    <script>
        function save_category(id){
            saved_prev=true;
            var cat_id = id;

            var save_button_id='save_cat_button'+id;
            document.getElementById(save_button_id).className="btn btn-success btn-rounded-20 mb-10"
            var cat_display_order = encodeURIComponent(document.getElementById("cat_display_order"+id).value);
            var cat_is_active = encodeURIComponent(document.getElementById("cat_is_active"+id).value);

            var save_category_url = '/movinCartAdmin/edit_category_from_service/?cat_id='+cat_id + '&cat_display_order='+cat_display_order + '&cat_is_active='+cat_is_active;
            $('#hidden').load(save_category_url, function(){

              });
            return false;
        }

    </script>
{% endblock %}